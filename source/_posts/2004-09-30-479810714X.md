---
layout: post
title: "バグがないプログラムのつくり方 JavaとEclipseで学ぶTDDテスト駆動開発"
date: 2004-09-30 23:59
comments: true
categories: [System]
keywords: "テスト駆動開発,TDD,Test-Driven-Developement,バグ,Java,Eclipse"
tags: [TDD,わかりやすい,定番,良書]
author: hamasyou
amazon_url: "http://www.amazon.co.jp/exec/obidos/ASIN/479810714X/sorehabooks-22"
amazon_author: "川端 光義 (著), 倉貫 義人 (著), 兒玉 督司 (著)"
amazon_image: "http://ec2.images-amazon.com/images/I/51XPEMTPVTL._SL500_AA300_.jpg"
amazon_publisher: "翔泳社"
---

テスト駆動開発(TDD)は、アジャイル開発に非常に良く適した開発技法である。プログラムを書く前にテストケースを書くという、今までの開発のやり方とはまったく逆の「目的から解法を求める」やり方です。このやり方だと何がいいのかというと、目的が見えているから(テストケースを満足させること)、解法が非常にシンプルになることです。つまり無駄がなくなる。トヨタのカンバン方式をご存知ならば、ほとんど一緒の考え方がこの<strong>テスト駆動開発</strong>になるのです。

本書は、今までの開発方法とは一風変わったテスト駆動開発を、日本人による解説と豊富なサンプルプログラムで分かりやすく理解できます。なぜテスト駆動がいいのかということを、余すことなくかかれています。

開発者だけでなく管理者の方も、本書を読むことで品質の良いプログラムを作るためのきっかけが得られるのではないかと思います。とても良い本だと思うので、少しでもテスト駆動開発に興味のある方は読んでみてください。


<!-- more -->

<h2>解説</h2>

本書のタイトルに『バグがないプログラムの作り方』とあるので、プログラミング技法の本かと思いますが実は違います。

本書は、テスト駆動開発という開発手法の本となります。今までの開発は、「十分な設計 ⇒ 実装 ⇒ テスト」の順で行われているのが主だったと思います。が、テスト駆動開発だと、開発の流れが「必要最低限の設計 ⇒ テスト ⇒ 実装」の順になります。

実装の前にテストを行うのが、テスト駆動開発の特徴です。実装前にテストを行うことに意味があるのかというと、ここに非常に意味があります。品質のよいプログラムを書くためにはテストを最初に行う必要があります。

テスト駆動で開発すると良い事が、本書の中で非常に丁寧に分かりやすく、納得しやすく書いてあるので興味がわいてきたら読んでみてください。すらすら読めてしまうので、3時間もあればほとんど読めてしまうと思います。非常に良いことがかいてあります。

<h2>覚書き</h2>

<h3>リズムが大切</h3>

テスト駆動開発で重要な要素の一つして「リズム」があります。一般的にテスト駆動で開発するときには[ class="extlink" target="_blank">xUnit](http://d.hatena.ne.jp/keyword/xUnit?kid=23897)というテスティングフレームワークを使います。本書では[ class="extlink" target="_blank">JUnit](http://www.alles.or.jp/~torutk/oojava/maneuver/2000/6-3.html)を使っています。

このJUnitは、テストに成功すると「グリーン｣、失敗すると「レッド」のバーが出力されます。

<strong>テスト駆動開発では、「レッド、グリーン、リファクタリング」というリズムを絶えず繰り返すことが、テスト駆動開発の極意</strong>となっています。最初にテストに失敗することからスタートします。ずっとグリーンだと、ほんとにプログラムがあっているのか不安になってきます。ですので、最初に「レッド」からスタートします。

グリーンにした後にリファクタリングを行うのがポイントで、最初のグリーンにする作業では、一番簡単なやり方(Fake It!)でテストをパスすることだけを考えます。次のリファクタリングフェーズで、重複をなくすようなコードに変更していきます。

テスト駆動で開発するときに、最初のレッドにする作業とグリーンにする作業が非常にかったるくなってくることがあります。でも、ここが我慢のしどころで、「レッド、グリーン、リファクタリング」のリズムを守ることを重視してください。折れそうになったら、「ペアプログラミング」をして、パートナーに何とか抑制してもらいましょう。

<h3>テストコードを書くときのポイント</h3>

<ul><li>テストコードにはコードの意図を伝えるコメントを入れる</li><li>テスト同士が関連するのは避ける</li><li>テストの名前には何のテストをしているかと分かる名前を付ける</li></ul>

テストコードには、引数の意味や数字の意味などを書いておくべきです。テストコードにはリテラルがそのまま使われることが多々ありますので、後々見たときに数字の意味が分かるようにしておくようにします。

プログラムに修正が入る場合、テストコードから最初に修正します。また、テストコードより先にテストコードに書いたコメントを最初に修正します。

<h3>テスト駆動とDependency Injection</h3>

[ class="extlink" target="_blank">Dependency Injection(依存性注入)](http://www.kakutani.com/trans/fowler/injection.html)というものがあります。これは簡単に言うと、クラスの関連を実装と切り離しておいて、第三者によって実装を設定させるというものです。(あんまり上手く説明できてないな・・・)
　
テスト駆動開発を行う上で、あるメソッドをテストするときにクラスの関連が多すぎてテストしにくい場合が出てきます。その場合、設計を見直して関連を減らすことが出来ればいいのですが、出来ない場合も出てきます。

そんな時、MockオブジェクトのほかにもDIを使うことでテストしやすくできます。

<h4>参考</h4>

<ul>
<li>[ class="extlink" target="_blank">Object Garden](http://blog.drecom.jp/object-garden/archive/28)</li>
<li>[ class="extlink" target="_blank">モック・オブジェクト 対 コンテナ内テスト](http://www.ingrid.org/jajakarta/cactus/doc/mockobjects.html)</li>
</ul>

<h3>「テスト可能」なアプリケーションにするための7つの原則</h3>

<dl>
<dt>1. GUIビューの外側に</dt>
<dd>GUIのビューからコードを切り離すことが出来れば、単純なメソッド呼び出しとしてコードをテスト出来るようになる。</dd>
<dt>2. 型によるエラー検査</dt>
<dd>型の検査はシステムが自動的に行ってくれます。高い抽象度で型を切り出すことは、ほとんどの場合よいことです。</dd>
<dt>3. 「断層線」を避けるために仲介機能(mediator)を利用する</dt>
<dd>独立したコンポーネント同士のインターフェースに仲介役を用意すると、公開メソッドの呼び出しのみを使ってコンポーネントをテストすることが簡単になります。</dd>
<dt>4. メソッド、小さなシグニチャーおよびデフォルトの引数</dt>
<dd>小さな引数や、シグネチャを持つメソッドが複数(オーバーライド)あるほうが、テスト時に簡単に呼び出せます。</dd>
<dt>5. アクセサーは、メモリー状態を修正してはいけない</dt>
<dd>テストでオブジェクトの状態を検査するときには、オブジェクトの状態を変更しない用にするべきです。さもなければ、内部状態を検査しにくくなってしまいます。</dd>
<dt>6. インターフェースを使ってプログラム外のコンポーネントを明示する</dt>
<dd>プログラム外のコンポーネント接続にはインターフェースを使うことで、すべてのコードがそろわなくてもテストすることが出来るようになります。</dd>
<dt>7. 最初にテストから考える</dt>
<dd>最初にテストから実装することで、実装段階で間違いを発見することが出来るようになります。</dd>
</dl>

<h4>参考</h4>

[ target="_blank" class="extlink">「テスト可能な」アプリケーションの設計 IBM](http://www-6.ibm.com/jp/developerworks/java/020125/j_j-diag0911.html)

<h2>参考</h2>

+ テスト駆動開発といったらケントベックは外せません。

<div class="rakuten"><table border="0" cellpadding="5" width="400"><tr><td valign="top">[<img src="http://images-jp.amazon.com/images/P/4894717115.09.MZZZZZZZ.jpg"   border="0" />](http://www.amazon.co.jp/exec/obidos/ASIN/4894717115/sorehabooks-22/)</td><td valign="top" />[テスト駆動開発入門](http://www.amazon.co.jp/exec/obidos/ASIN/4894717115/sorehabooks-22/)<br />ケント ベック, Kent Beck, 長瀬 嘉秀, テクノロジックアート<br /><iframe scrolling="no" frameborder="0" width="250" height="40" hspace="0" vspace="0" marginheight="0" marginwidth="0" src="http://xml-jp.amznxslt.com/onca/xml3?dev-t=D2JW5SAFEH7L0B&t=goodpic-22&f=http://www.g-tools.com/xsl/aws-price-ffffff.xsl&locale=jp&type=lite&AsinSearch=4894717115"></iframe><br /><br /><font size="-1"><b>おすすめ平均</b><img src="http://g-images.amazon.com/images/G/01/detail/stars-3-5.gif"   /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-2-0.gif"   />XPに親しみを感じているなら<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-3-0.gif"   />想定読者レベルはバリバリの実装者・・・<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-4-0.gif"   />TDDプログラマの思考過程が読める<br /></font><br />[ /><font size="-1">Amazonで詳しく見る</font>](http://www.amazon.co.jp/exec/obidos/ASIN/4894717115/sorehabooks-22/)<img src="http://www.g-tools.com/img/spacer.gif"   width="50" height="1" />[ /><img src="http://www.g-tools.com/img/powered-by-gtool.gif"   border="0" alt="4894717115"/>](http://www.goodpic.com/mt/aws/)<br /></td></tr></table>
</div>

+ JUnitに関することならこれがおすすめ

<div class="rakuten"><table border="0" cellpadding="5" width="400"><tr><td valign="top">[<img src="http://images-jp.amazon.com/images/P/4797325143.09.MZZZZZZZ.jpg"   border="0" />](http://www.amazon.co.jp/exec/obidos/ASIN/4797325143/sorehabooks-22/)</td><td valign="top" />[JUnitイン・アクション](http://www.amazon.co.jp/exec/obidos/ASIN/4797325143/sorehabooks-22/)<br />ビンセント マソル, テッド ハスティード, Vincent Massol, Ted Husted, クイープ<br /><iframe scrolling="no" frameborder="0" width="250" height="40" hspace="0" vspace="0" marginheight="0" marginwidth="0" src="http://xml-jp.amznxslt.com/onca/xml3?dev-t=D2JW5SAFEH7L0B&t=goodpic-22&f=http://www.g-tools.com/xsl/aws-price-ffffff.xsl&locale=jp&type=lite&AsinSearch=4797325143"></iframe><br /><br /><br />[<font size="-1">Amazonで詳しく見る</font>](http://www.amazon.co.jp/exec/obidos/ASIN/4797325143/sorehabooks-22/)<img src="http://www.g-tools.com/img/spacer.gif"   width="50" height="1" />[ /><img src="http://www.g-tools.com/img/powered-by-gtool.gif"   border="0" alt="4797325143"/>](http://www.goodpic.com/mt/aws/)<br /></td></tr></table>
</div>

+ テストファースト開発に関して分かりやすく解説しています。JUnitの使い方に関しても解説されています。

<div class="rakuten"><table border="0" cellpadding="5" width="400"><tr><td valign="top">[<img src="http://images-jp.amazon.com/images/P/4797325720.09.MZZZZZZZ.jpg"   border="0" />](http://www.amazon.co.jp/exec/obidos/ASIN/4797325720/sorehabooks-22/)</td><td valign="top" />[JUnitによるテストファースト開発入門](http://www.amazon.co.jp/exec/obidos/ASIN/4797325720/sorehabooks-22/)<br />サイバービーンズ ， 今野 睦<br /><iframe scrolling="no" frameborder="0" width="250" height="40" hspace="0" vspace="0" marginheight="0" marginwidth="0" src="http://xml-jp.amznxslt.com/onca/xml3?dev-t=D2JW5SAFEH7L0B&t=goodpic-22&f=http://www.g-tools.com/xsl/aws-price-ffffff.xsl&locale=jp&type=lite&AsinSearch=4797325720"></iframe><br /><br /><font size="-1"><b>おすすめ平均</b><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif"   /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif"   />ソフトウェアテスト本の新スタンダードかも<br /></font><br />[ /><font size="-1">Amazonで詳しく見る</font>](http://www.amazon.co.jp/exec/obidos/ASIN/4797325720/sorehabooks-22/)<img src="http://www.g-tools.com/img/spacer.gif"   width="50" height="1" />[ /><img src="http://www.g-tools.com/img/powered-by-gtool.gif"   border="0" alt="4797325720"/>](http://www.goodpic.com/mt/aws/)<br /></td></tr></table>
</div>




