---
layout: post
title: "サーバサイドJavaScript Node.js入門"
date: 2014-03-04 23:24:06 +0900
comments: true
categories: [Programming]
keywords: "サーバサイド,JavaScript,Node.js,Node,4048703676"
tags: [Node,JavaScript]
sharing: true
published: true
amazon_url: "http://www.amazon.co.jp/gp/product/4048703676?ie=UTF8&camp=247&creativeASIN=4048703676&linkCode=xm2&tag=sorehabooks-22"
amazon_author: "清水俊博 (著), 大津繁樹 (著), Jxck (著), 小林秀和 (著), 佐々木庸平 (著), 篠崎祐輔 (著), 高木敦也 (著), 西山雄也 (著)"
amazon_image: "http://ecx.images-amazon.com/images/I/511TIB5mncL._SS300_.jpg"
amazon_publisher: "アスキー・メディアワークス"
og_image: ""
---

本書は、「**Node** って何？」という人から「Node の中身はどうなっているの？」を知りたい人のために幅広く網羅的に書かれています。

1. Node の基本から順番に理解していきたい
1. Node を使ってすぐに Web アプリケーションを作ってみたい
1. Node の内部構造を理解したい

これらのモデルケースに合う人にオススメの書籍です。

<!-- more -->

# おぼえがき

## Node とはなにか？

*Node はプログラミング言語ではありません*。言語としては **JavaScript** を使います。
*Node は JavaScript ライブラリではありませんし、アプリケーションフレームワークでもありません*。

Node はスケーラビリティに優れた、Web アプリケーションを実行するためのサーバサイドのプラットフォームです。
特徴は、I/O 処理が非同期で行われプラットフォーム自体がサーバ機能を提供する方式であることです。

JavaScript で実現されたイベントループと非同期処理の仕組み、**WebSocket** との相性の良さ、V8 エンジン搭載などの技術的に優れた部分を持ち合わせています。
*Node は、従来の同期処理から決別し、ライブラリを含めてスレッドをブロックすることのない世界を作り上げました*。

### JavaScript である理由

JavaScript ではスレッドライブラリが定義されておらず、多くの実装はシングルスレッドで動作します。また、イベントの仕組みをうまくつかって非同期処理を行います。
Node の世界にマッチさせるライブラリは非同期で動作しなければなりませんが、サーバサイドで JavaScript は今までほとんど使われてこなかったため、
サーバサイドのライブラリはゼロから作り上げる必要がありました。つまり、*過去の資産を気にすることなく非同期かつスレッドをブロックしない I/O を利用させることが可能でした*。

近年爆発的にユーザ数が増えると、**C10K** という問題が起こることがクローズアップされ始めました。
従来のアーキテクチャは、クライアントのアクセスに対して一つのスレッドを割り当てるマルチスレッドモデルで同時アクセスをさばいていました。
しかし、これではユーザ数が増えた際にスレッドを大量に生成しなければならず、この部分がボトルネックになるようになりました。

そこで、マルチスレッドモデルに対して、**シングルスレッド+イベントループ** により複数のクライアントをさばくというモデルがではじめました。
JavaScript はシングルスレッドモデルですし、イベントループの仕組みを使って非同期処理を行うようになっています。この C10K 問題に対する解として JavaScript はうってつけだったのです。

### Node とリアルタイムアプリケーション

HTML5 が世に広まり始めると、その仕様の一部として策定されていた **WebSocket** プロトコルが注目されるようになってきました。（現在では HTML5 とは独立した仕様になっています。）

WebSocket は HTTP 通信とは異なり、接続を維持したまま通信することが前提のプロトコルです。接続確立時には HTTP をつかいますが、その後の通信では独自のプロトコルを使います。
そのため、WebSocket でリアルタイム通信を行おうとするとサーバ側も対応しなければならず、大掛かりになりがちでした。

Node はプログラム内にサーバ機能を実装可能であるという特徴から、WebSocket 用のモジュールが用意されました。
これらのモジュールを使うことで簡単に WebSocket を利用したアプリケーションが構築できるようになりました。

こうして、リアルタイム通信を行うなら Node という方程式が出来上がったのです。


### Node のプログラム

Node はイベントループが回ることですべての処理をさばきます。Node のプログラムは **必要なイベントハンドラを登録し、適切なタイミングでイベントを発生させる** ことで成立しています。
これは、ブラウザ上の JavaScript とほとんど同じプログラムコードになります。


## モジュール

Node のモジュールは JavaScript で記述されたファイルか、アドオンと呼ばれる C/C++ で記述されコンパイルされたファイルで構成されます。

Node では **1つのファイルは必ず1つのモジュールに対応します**。
あるファイルをモジュールとして利用可能にするには `module` オブジェクトか `exports` オブジェクトを使って必要な関数、オブジェクトを公開します。

```javascript
module.exports = {
  funcA: function() {
  }
};

function funcB() {
}
module.exports.funcB = funcB;

// exports を外部公開オブジェクトとして定義する場合は慣例として次のように書く
module.exports = exports = {
  foo: 'bar',
  funcA: function() {
  }
};
```

## 感想

Node とはなにか？Node の仕組みを知りたい、Node を始めたいという人向けのタイトル通りの「入門」書だと思いました。
実際に使われているモジュールやフレームワークの説明なども入っているので、コレ一冊でとりあえず Node を始められるようになっています。
ここから始めて見て、壁にあたったら次の参考書を読んでみるという感じがいいんじゃないかと思います。

内容としては、プログラミング知識がある人（とくに JavaScript）なら、優しすぎず難しすぎずという感じです。


## 目次

1. Node とは何か
    1. 非同期プログラミング
    1. なぜ従来から非同期プログラミングが行われてこなかったのか
    1. Node の誕生と既存の言語
    1. JavaScript である理由
    1. シングルスレッドの強み
    1. Node とリアルタイムアプリケーション
1. インストール
    1. OS ごとのインストール方法
    1. 環境構築ツールを使う
    1. npm を使ったパッケージのインストール
1. 開発環境
    1. エディタ
    1. IDE
1. Node入門
    1. Node コマンド
    1. イベントループ
    1. HTTP サーバ
    1. イベントループの落とし穴
    1. まとめ
1. モジュール
    1. モジュールの作り方
    1. モジュールの使い方
    1. モジュール活用
1. イベント
    1. Node とイベント駆動プログラミング
    1. イベントの作成と利用
    1. リスナ配列
    1. 特殊なイベント
    1. シグナルとイベント
    1. まとめ
1. イベントループとprocess.nextTick()
    1. Node のイベントループの仕組み
    1. 非同期イベントの生成
    1. 非同期コールバックの呼び出し
1. ストリーム、バッファ、ファイルシステム
    1. ストリーム
    1. Buffer
    1. ファイルシステム
1. ソケット（TCP/UDP）
    1. net モジュール
    1. TCP サーバの概要
    1. TCP クライアントの概要
    1. TCP エコーサーバ・クライアントの実装
    1. TCP と同期プロトコル
    1. drain イベントを利用したデータ送信制御
    1. TLS 通信の利用
    1. OS のTCP 機能と直接関わるAPI
    1. dgram モジュール
1. HTTP/HTTPS
    1. http モジュール
    1. http.Server のエコーサーバの実装
    1. HTTP RESTful サーバの実装
    1. HTTP クライアントの概要
    1. https モジュール
    1. url モジュール
    1. querystring モジュール
1. Domain
    1. domain モジュールの概要
    1. domain モジュールのクラス
    1. ドメインへのオブジェクトと関数の結びつけ
    1. Implicit Binding
    1. Explicit Binding
    1. ドメインを利用したエラーページの表示
1. ユニットテスト
    1. はじめに
    1. assert
    1. should
    1. chai
    1. mocha
    1. vows
1. デバッグ
    1. デバッガの基本機能
    1. 組み込みデバッガを利用したCUI でのデバッグ
    1. Node Inspector を利用したGUI でのデバッグ
    1. 組み込みデバッガとNode Inspector の使い分け
    1. IDE でのデバッグ
    1. その他のサードパーティのデバッグモジュール
1. 実践編導入
    1. 実践編で扱う技術について
    1. 共通して扱うモジュール
1. Express入門
    1. はじめに
    1. Express の導入
    1. Connect のアーキテクチャ
    1. Express のアーキテクチャ
1. Express を用いたフォーラムアプリケーションの作成
    1. はじめに
    1. ルーティング
    1. データの永続化
    1. その他のリクエストメソッド
    1. ビューの改善
    1. エラー処理
    1. ミドルウェア
    1. ユーザー登録とログインの実装
    1. セッション
    1. ルートミドルウェア
    1. remember me の実装
    1. Tips
    1. 終わりに
1. Socket.IO を使ったファイル共有アプリケーションの作成
    1. はじめに
    1. 準備
    1. ユーザー名の指定
    1. チャンネルの実装
    1. ファイルの送信
    1. ファイルの受信
    1. ファイルの永続化
    1. ファイルの配信
    1. 終わりに
1. 外部API との連携
    1. ハッシュタグストリーミング
    1. 今一緒にいる人を一括フォロー
    1. 終わりに
1. Node はどう作られているか
    1. JavaScript とNode
    1. C10K とNode
    1. Web アプリケーションアーキテクチャとしてのNode
1. 非同期プログラミングの改善
    1. はじめに
    1. コールバック関数の問題
    1. コールバック関数の改善
    1. まとめ
1. アドオンの作成
    1. 概要
    1. シンプルなHelloWorld のサンプル（オブジェクトの作成）
    1. メソッドを持つアドオンのサンプル
1. npm パッケージ
    1. チュートリアル
    1. パッケージの公開
    1. パッケージの詳細
    1. まとめ
1. スケーラビリティ
    1. 複数プロセスの起動
    1. 複数サーバでのスケールアウト
    1. 終わりに
1. 運用
    1. Apache やNginx との連携
    1. 環境
